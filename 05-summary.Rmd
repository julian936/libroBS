# Modelo Prophet y Enfoque de Regresión {#prophet}

```{r setup-cap4, include=FALSE}
# Configuración para ocultar código por defecto
knitr::opts_chunk$set(
  echo = FALSE,           # Ocultar código
  warning = FALSE,        # Ocultar warnings
  message = FALSE,        # Ocultar mensajes
  fig.align = 'center'    # Centrar figuras
)
```


## Flujo de Análisis del Capítulo

```
                    ┌─────────────────────────────────────┐
                    │   DATOS DE SERIES DE TIEMPO         │
                    │   (6 Acciones: 2015-2025)           │
                    │   AAPL, MSFT, TSLA, PFE, MRNA, JNJ  │
                    └──────────────┬──────────────────────┘
                                   │
                                   ▼
                    ┌─────────────────────────────────────┐
                    │   PREPARACIÓN DE DATOS              │
                    │   • Formato ds/y para Prophet       │
                    │   • Transformación Logarítmica      │
                    │   • División Train/Test (60 días)   │
                    └──────────────┬──────────────────────┘
                                   │
                    ┌──────────────┴──────────────┐
                    │                             │
                    ▼                             ▼
      ┌──────────────────────────┐   ┌──────────────────────────┐
      │   MODELO PROPHET         │   │   ENFOQUE REGRESIÓN      │
      │                          │   │                          │
      │  • Tendencia (g(t))      │   │  • Regresión Lineal      │
      │  • Estacionalidad (s(t)) │   │  • Regresión Polinomial  │
      │  • Changepoints          │   │  • Variables Exógenas    │
      │  • Intervalos confianza  │   │    (volumen, tiempo)     │
      └──────────┬───────────────┘   └──────────┬───────────────┘
                 │                              │
                 ▼                              ▼
      ┌──────────────────────────┐   ┌──────────────────────────┐
      │  COMPONENTES PROPHET     │   │  ANÁLISIS DE REGRESIÓN   │
      │                          │   │                          │
      │  • Tendencia             │   │  • Coeficientes          │
      │  • Estacionalidad Anual  │   │  • R² ajustado           │
      │  • Estacionalidad Semanal│   │  • Diagnóstico residuos  │
      │  • Changepoints visual   │   │  • AIC comparación       │
      └──────────┬───────────────┘   └──────────┬───────────────┘
                 │                              │
                 └──────────────┬───────────────┘
                                │
                                ▼
                 ┌─────────────────────────────────────┐
                 │   EVALUACIÓN DE MODELOS             │
                 │                                     │
                 │   Métricas:                         │
                 │   • RMSE (Error Cuadrático Medio)   │
                 │   • MAE (Error Absoluto Medio)      │
                 │   • MAPE (Error Porcentual)         │
                 │                                     │
                 │   Escalas:                          │
                 │   • Logarítmica                     │
                 │   • Original (USD)                  │
                 └──────────────┬──────────────────────┘
                                │
                                ▼
                 ┌─────────────────────────────────────┐
                 │   COMPARACIÓN Y VISUALIZACIÓN       │
                 │                                     │
                 │   • Prophet vs Regresión            │
                 │   • Valores Reales vs Pronósticos   │
                 │   • Intervalos de Confianza         │
                 │   • Análisis por Acción             │
                 └──────────────┬──────────────────────┘
                                │
                                ▼
                 ┌─────────────────────────────────────┐
                 │   APLICACIÓN MÚLTIPLE               │
                 │   (6 Acciones)                      │
                 │                                     │
                 │   Tabla comparativa métricas        │
                 │   AAPL │ MSFT │ TSLA                │
                 │   PFE  │ MRNA │ JNJ                 │
                 └──────────────┬──────────────────────┘
                                │
                                ▼
                 ┌─────────────────────────────────────┐
                 │   CONCLUSIONES                      │
                 │                                     │
                 │   • Viabilidad de Regresión ✓       │
                 │   • Complementariedad de Enfoques   │
                 │   • Limitaciones Identificadas      │
                 │   • Recomendaciones Prácticas       │
                 │   • Propuesta Modelo Híbrido        │
                 └─────────────────────────────────────┘
```

## Introducción

En respuesta a la necesidad de pronósticos robustos y automatizados en series de tiempo financieras, este capítulo aplica el algoritmo **Prophet** desarrollado por el equipo de Core Data Science de Facebook. Prophet fue diseñado para manejar características complejas de las series de tiempo, como tendencias no lineales, múltiples estacionalidades y cambios estructurales, características presentes en los precios de acciones analizados en capítulos anteriores.

Adicionalmente, se explorará el **enfoque de regresión** para series de tiempo, complementando los modelos ARIMA y de estacionariedad previamente planteados. Este enfoque permite incorporar variables exógenas y entender la relación entre el tiempo y los precios como una función determinística más un componente estocástico.

## Fundamentos de Prophet

Prophet descompone una serie de tiempo en tres componentes principales mediante un **modelo aditivo**:

$$y(t) = g(t) + s(t) + h(t) + \epsilon_t$$

Donde:

- $g(t)$: **Tendencia** - Modela cambios no lineales en el valor base de la serie
- $s(t)$: **Estacionalidad** - Captura patrones periódicos (semanales, mensuales, anuales)
- $h(t)$: **Efectos de días festivos** - Incorpora eventos irregulares
- $\epsilon_t$: **Error** - Componente no explicado por el modelo

### Ventajas de Prophet para Series Financieras

1. **Detección automática de changepoints**: Identifica quiebres estructurales como el crash COVID-19
2. **Robustez ante valores atípicos**: No se ve afectado por picos de volatilidad extrema
3. **Manejo de datos faltantes**: Útil en mercados con días no hábiles
4. **Intervalos de incertidumbre**: Proporciona bandas de confianza para pronósticos
5. **Flexibilidad en estacionalidad**: Puede capturar patrones complejos en datos diarios

## Preparación de Datos

Prophet requiere un formato específico de datos con dos columnas:

- `ds`: Fecha (date stamp)
- `y`: Valor de la variable objetivo

Seleccionaremos **Tesla (TSLA)** para el análisis detallado por las siguientes razones:

1. Mayor volatilidad histórica (59.30%) - prueba rigurosa para el modelo
2. Mayor retorno total (+2,728%) - evidencia de tendencia fuerte
3. Múltiples quiebres estructurales visibles en el período analizado
4. Alta sensibilidad a eventos externos (COVID, políticas gubernamentales)

```{r preparacion-prophet, warning=FALSE, message=FALSE}
library(prophet)
library(tidyverse)
library(lubridate)
library(quantmod)
library(Metrics)

# Cargar datos de Tesla
getSymbols("TSLA", from = "2015-10-13", to = "2025-10-10", src = "yahoo")

# Preparar datos para Prophet
tesla_prophet <- data.frame(
  ds = index(TSLA),
  y = as.numeric(Cl(TSLA))  # Precio de cierre
) %>%
  na.omit()

# Mostrar estructura
head(tesla_prophet)
tail(tesla_prophet)

# Resumen estadístico
summary(tesla_prophet$y)
```

### Transformación Logarítmica

Para estabilizar la varianza y mejorar el ajuste del modelo, aplicamos una **transformación logarítmica** a los precios:

```{r transformacion-log}
tesla_prophet_log <- tesla_prophet %>%
  mutate(y = log(y))

# Visualización comparativa
par(mfrow = c(2, 1), mar = c(4, 4, 2, 1))
plot(tesla_prophet$ds, tesla_prophet$y, type = 'l', 
     main = "Precio de Tesla - Escala Original",
     xlab = "Fecha", ylab = "Precio (USD)", col = "blue")
plot(tesla_prophet_log$ds, tesla_prophet_log$y, type = 'l', 
     main = "Precio de Tesla - Escala Logarítmica",
     xlab = "Fecha", ylab = "Log(Precio)", col = "darkgreen")
```

**Justificación de la transformación logarítmica**:

1. Los precios de acciones siguen un proceso multiplicativo (retornos porcentuales constantes)
2. Reduce heterocedasticidad (varianza no constante)
3. Convierte tendencias exponenciales en lineales
4. Los errores de pronóstico se interpretan como errores porcentuales

## Ajuste del Modelo Prophet

### Configuración del Modelo

```{r ajuste-prophet, warning=FALSE, message=FALSE}
# Dividir en entrenamiento y prueba
# Últimos 60 días para prueba (aproximadamente 3 meses de trading)
n_test <- 60
n_train <- nrow(tesla_prophet_log) - n_test

train_data <- tesla_prophet_log[1:n_train, ]
test_data <- tesla_prophet_log[(n_train + 1):nrow(tesla_prophet_log), ]

cat("Longitud del conjunto de entrenamiento:", n_train, "días\n")
cat("Longitud del conjunto de prueba:", n_test, "días\n")
cat("Fecha inicio entrenamiento:", as.character(min(train_data$ds)), "\n")
cat("Fecha fin entrenamiento:", as.character(max(train_data$ds)), "\n")
cat("Fecha inicio prueba:", as.character(min(test_data$ds)), "\n")
cat("Fecha fin prueba:", as.character(max(test_data$ds)), "\n")
```

```{r modelo-prophet, warning=FALSE, message=FALSE, results='hide'}
# Configurar modelo Prophet
modelo_prophet <- prophet(
  train_data,
  changepoint.prior.scale = 0.05,  # Flexibilidad para detectar changepoints
  seasonality.prior.scale = 10,     # Importancia de estacionalidad
  n.changepoints = 25,              # Número de posibles puntos de cambio
  yearly.seasonality = TRUE,        # Estacionalidad anual
  weekly.seasonality = TRUE,        # Estacionalidad semanal
  daily.seasonality = FALSE         # No aplica para datos diarios de acciones
)
```

**Parámetros clave**:

- `changepoint.prior.scale = 0.05`: Controla la flexibilidad de la tendencia. Valores bajos (0.05) hacen la tendencia más conservadora, útil para evitar sobreajuste en series volátiles.
- `n.changepoints = 25`: Permite al modelo identificar hasta 25 cambios significativos en la tendencia.
- `yearly.seasonality = TRUE`: Captura patrones anuales (ej. rally de fin de año).
- `weekly.seasonality = TRUE`: Captura patrones semanales en el mercado de valores.

### Generación de Pronósticos

```{r pronosticos-prophet}
# Crear dataframe futuro para pronóstico
future <- make_future_dataframe(modelo_prophet, periods = n_test, freq = 'day')

# Filtrar solo días hábiles (lunes a viernes)
future <- future %>%
  filter(!(wday(ds) %in% c(1, 7)))  # Excluir domingos (1) y sábados (7)

# Generar pronósticos
forecast <- predict(modelo_prophet, future)

# Mostrar columnas relevantes del pronóstico
head(forecast[, c('ds', 'yhat', 'yhat_lower', 'yhat_upper', 'trend', 'weekly', 'yearly')])
```

## Evaluación del Modelo

### Métricas en Escala Logarítmica

```{r metricas-log}
# Tomar últimas predicciones
forecast_test <- tail(forecast, n_test)

# Ajustar longitudes
if(nrow(test_data) != nrow(forecast_test)) {
  n_min <- min(nrow(test_data), nrow(forecast_test))
  test_data <- tail(test_data, n_min)
  forecast_test <- tail(forecast_test, n_min)
}

# Extraer vectores
y_real <- test_data$y
y_pred <- forecast_test$yhat

# Eliminar NAs
idx <- complete.cases(y_real, y_pred)
y_real <- y_real[idx]
y_pred <- y_pred[idx]

# Calcular métricas
rmse_log <- sqrt(mean((y_real - y_pred)^2))
mae_log <- mean(abs(y_real - y_pred))
mape_log <- mean(abs((y_real - y_pred) / y_real)) * 100

cat("\n=== Métricas (Escala Log) ===\n")
cat("RMSE:", round(rmse_log, 4), "\n")
cat("MAE:", round(mae_log, 4), "\n")
cat("MAPE:", round(mape_log, 2), "%\n")
```

### Métricas en Escala Original

```{r metricas-original}
# Transformar a escala original
test_original <- exp(y_real)
forecast_original <- exp(y_pred)

# Calcular métricas
rmse_original <- sqrt(mean((test_original - forecast_original)^2))
mae_original <- mean(abs(test_original - forecast_original))
mape_original <- mean(abs((test_original - forecast_original) / test_original)) * 100

cat("\n=== Métricas (Escala USD) ===\n")
cat("RMSE: $", format(round(rmse_original, 2), big.mark = ","), "\n", sep = "")
cat("MAE: $", format(round(mae_original, 2), big.mark = ","), "\n", sep = "")
cat("MAPE:", round(mape_original, 2), "%\n")
```

### Visualización del Pronóstico

```{r vis-forecast-test, fig.height=6, fig.width=10, fig.cap="Pronóstico vs Valores Reales"}
# Preparar datos para gráfico
n_datos <- length(y_real)
datos_plot <- data.frame(
  ds = tail(test_data$ds, n_datos),
  y_real = y_real,
  y_pred = y_pred,
  yhat_lower = tail(forecast_test$yhat_lower, n_datos),
  yhat_upper = tail(forecast_test$yhat_upper, n_datos)
)

# Crear gráfico
ggplot(datos_plot, aes(x = ds)) +
  geom_ribbon(aes(ymin = yhat_lower, ymax = yhat_upper),
              alpha = 0.2, fill = "red") +
  geom_line(aes(y = y_real, color = "Real"), linewidth = 0.8) +
  geom_line(aes(y = y_pred, color = "Pronóstico"), 
            linewidth = 0.8, linetype = "dashed") +
  scale_color_manual(values = c("Real" = "black", "Pronóstico" = "red")) +
  labs(title = "Tesla (TSLA): Pronóstico con Prophet - Escala Logarítmica",
       subtitle = paste0("RMSE = ", round(rmse_log, 4), " | MAE = ", round(mae_log, 4)),
       x = "Fecha", y = "Log(Precio)", color = "") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r vis-forecast-original, fig.height=6, fig.width=10, fig.cap="Pronóstico Escala Original"}
# Preparar datos en escala original
n_datos <- length(test_original)
datos_plot_orig <- data.frame(
  ds = tail(test_data$ds, n_datos),
  y_real = test_original,
  y_pred = forecast_original,
  yhat_lower = exp(tail(forecast_test$yhat_lower, n_datos)),
  yhat_upper = exp(tail(forecast_test$yhat_upper, n_datos))
)

# Gráfico
ggplot(datos_plot_orig, aes(x = ds)) +
  geom_ribbon(aes(ymin = yhat_lower, ymax = yhat_upper),
              alpha = 0.2, fill = "red") +
  geom_line(aes(y = y_real, color = "Real"), linewidth = 0.8) +
  geom_line(aes(y = y_pred, color = "Pronóstico"), 
            linewidth = 0.8, linetype = "dashed") +
  scale_color_manual(values = c("Real" = "black", "Pronóstico" = "red")) +
  scale_y_continuous(labels = scales::dollar_format()) +
  labs(title = "Tesla (TSLA): Pronóstico con Prophet - Escala Original",
       subtitle = paste0("MAE = $", format(round(mae_original, 2), big.mark = ","), 
                        " | MAPE = ", round(mape_original, 2), "%"),
       x = "Fecha", y = "Precio (USD)", color = "") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

## Análisis de Componentes

Prophet permite descomponer la serie en sus componentes fundamentales:

```{r componentes-prophet, fig.height=8, fig.width=10, fig.cap="Descomposición de Componentes del Modelo Prophet"}
prophet_plot_components(modelo_prophet, forecast)
```

### Interpretación de Componentes

1. **Tendencia (Trend)**: 
   - Muestra el comportamiento de largo plazo del precio de Tesla
   - Se observan múltiples changepoints (cambios de dirección)
   - Períodos identificables: crecimiento pre-COVID, caída COVID, recuperación explosiva post-COVID

2. **Estacionalidad Semanal (Weekly)**:
   - Aunque menos pronunciada que en otras series, existe un patrón
   - Los lunes tienden a mostrar mayor volatilidad (apertura semanal)
   - Los viernes pueden mostrar ajustes pre-cierre semanal

3. **Estacionalidad Anual (Yearly)**:
   - Patrones sutiles relacionados con:
     - Rally de fin de año (diciembre-enero)
     - Efecto enero (nuevas inversiones)
     - Ajustes de medio año (junio-julio)

### Visualización de Changepoints

```{r changepoints, fig.height=6, fig.width=10, fig.cap="Changepoints Detectados por Prophet"}
# Visualizar serie completa con changepoints
plot(modelo_prophet, forecast) +
  add_changepoints_to_plot(modelo_prophet) +
  labs(title = "Tesla (TSLA): Tendencia y Changepoints Detectados",
       x = "Fecha",
       y = "Log(Precio)") +
  theme_minimal()
```

Los **changepoints** (líneas verticales) representan momentos donde Prophet detectó cambios significativos en la tendencia. Estos puntos suelen coincidir con:

- Eventos corporativos (anuncios de ganancias, splits de acciones)
- Eventos macroeconómicos (políticas de Fed, crisis COVID-19)
- Cambios en la narrativa de la empresa (producción, innovación)

## Series de Tiempo como Regresión

### Fundamentación Teórica

Una serie de tiempo puede modelarse como una **regresión temporal** donde el tiempo actúa como variable explicativa:

$$y_t = \beta_0 + \beta_1 t + \beta_2 t^2 + ... + \beta_k t^k + \epsilon_t$$

Este enfoque tiene **ventajas complementarias** a los modelos ARIMA:

1. **Interpretabilidad**: Los coeficientes tienen interpretación económica directa
2. **Incorporación de variables exógenas**: Permite incluir volumen, índices, variables macro
3. **Modelado de tendencias complejas**: Polinomios o splines capturan no linealidades
4. **Predicción de largo plazo**: Menos dependiente de valores históricos recientes

### Justificación para Series Financieras

El enfoque de regresión es **viable y complementario** para las acciones analizadas por:

1. **Tendencia Determinística Fuerte**: 
   - Tesla muestra un crecimiento exponencial claro (+2,728%)
   - La tendencia domina sobre la componente estocástica
   
2. **Cambios Estructurales Identificables**:
   - Prophet ya identificó múltiples changepoints
   - Estos pueden modelarse con regresión segmentada o variables dummy

3. **Variables Exógenas Disponibles**:
   - Volumen de negociación (disponible en el dataset)
   - Índices de mercado (S&P 500, NASDAQ)
   - Indicadores de volatilidad (VIX)

4. **Complementa Modelos ARIMA**:
   - ARIMA captura autocorrelación de corto plazo
   - Regresión captura tendencia y efectos de variables externas
   - La combinación mejora pronósticos

### Modelo de Regresión Simple

```{r regresion-simple}
# Preparar datos para regresión
tesla_reg <- tesla_prophet_log %>%
  mutate(
    t = as.numeric(ds - min(ds)),  # Tiempo en días desde inicio
    t2 = t^2,                       # Término cuadrático
    t3 = t^3                        # Término cúbico
  )

# Modelo lineal
modelo_lineal <- lm(y ~ t, data = tesla_reg)

# Modelo polinomial (grado 3)
modelo_poly <- lm(y ~ t + t2 + t3, data = tesla_reg)

# Comparar modelos
cat("\n=== Modelo Lineal ===\n")
summary(modelo_lineal)$coefficients
cat("\nR² ajustado:", round(summary(modelo_lineal)$adj.r.squared, 4), "\n")
cat("AIC:", round(AIC(modelo_lineal), 2), "\n")

cat("\n=== Modelo Polinomial (Grado 3) ===\n")
summary(modelo_poly)$coefficients
cat("\nR² ajustado:", round(summary(modelo_poly)$adj.r.squared, 4), "\n")
cat("AIC:", round(AIC(modelo_poly), 2), "\n")
```

### Regresión con Variables Exógenas

```{r regresion-exogenas, warning=FALSE, message=FALSE}
# Agregar volumen como variable exógena
tesla_volume <- data.frame(
  ds = index(TSLA),
  volumen = as.numeric(Vo(TSLA))
) %>%
  na.omit()

tesla_reg_full <- tesla_reg %>%
  left_join(tesla_volume, by = "ds") %>%
  mutate(
    log_volumen = log(volumen + 1),  # Transformación log del volumen
    dia_semana = wday(ds, label = TRUE)  # Día de la semana
  )

# Modelo con volumen
modelo_volumen <- lm(y ~ t + t2 + log_volumen, data = tesla_reg_full)

cat("\n=== Modelo con Volumen ===\n")
summary(modelo_volumen)$coefficients
cat("\nR² ajustado:", round(summary(modelo_volumen)$adj.r.squared, 4), "\n")
cat("AIC:", round(AIC(modelo_volumen), 2), "\n")
```

### Visualización de Ajuste de Regresión

```{r vis-regresion, fig.height=6, fig.width=10, fig.cap="Comparación de Modelos de Regresión"}
# Agregar predicciones al dataframe
tesla_reg_full <- tesla_reg_full %>%
  mutate(
    pred_lineal = predict(modelo_lineal, newdata = tesla_reg_full),
    pred_poly = predict(modelo_poly, newdata = tesla_reg_full),
    pred_volumen = predict(modelo_volumen, newdata = tesla_reg_full)
  )

# Gráfico comparativo
ggplot(tesla_reg_full, aes(x = ds)) +
  geom_line(aes(y = y, color = "Real"), linewidth = 0.5, alpha = 0.6) +
  geom_line(aes(y = pred_lineal, color = "Lineal"), linewidth = 0.8) +
  geom_line(aes(y = pred_poly, color = "Polinomial"), linewidth = 0.8) +
  geom_line(aes(y = pred_volumen, color = "Con Volumen"), linewidth = 0.8) +
  scale_color_manual(values = c(
    "Real" = "black",
    "Lineal" = "blue",
    "Polinomial" = "red",
    "Con Volumen" = "darkgreen"
  )) +
  labs(title = "Tesla (TSLA): Comparación de Modelos de Regresión",
       x = "Fecha",
       y = "Log(Precio)",
       color = "Modelo") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

### Análisis de Residuos

```{r residuos-regresion, fig.height=8, fig.width=10, fig.cap="Diagnóstico de Residuos - Modelo Polinomial"}
par(mfrow = c(2, 2))
plot(modelo_poly)
```

**Observaciones sobre los residuos**:

1. **Residuals vs Fitted**: Muestra heterocedasticidad (varianza no constante)
2. **Q-Q Plot**: Colas pesadas indican desviaciones de la normalidad
3. **Scale-Location**: Confirma heterocedasticidad
4. **Residuals vs Leverage**: Identifica observaciones influyentes

### Comparación: Regresión vs Prophet

```{r comparacion-modelos}
# Preparar datos para regresión
n_datos <- length(y_real)
fechas_test <- tail(test_data$ds, n_datos)

datos_reg <- data.frame(
  ds = fechas_test,
  t = as.numeric(fechas_test - min(tesla_reg$ds))
)
datos_reg$t2 <- datos_reg$t^2
datos_reg$t3 <- datos_reg$t^3

# Predicción regresión
pred_poly_test <- predict(modelo_poly, newdata = datos_reg)

# Ajustar longitud
n_min <- min(length(y_real), length(pred_poly_test))

# Métricas regresión
rmse_reg <- sqrt(mean((y_real[1:n_min] - pred_poly_test[1:n_min])^2))
mae_reg <- mean(abs(y_real[1:n_min] - pred_poly_test[1:n_min]))

cat("\n=== Comparación de Modelos ===\n\n")
cat("Prophet:\n")
cat("  RMSE:", round(rmse_log, 4), "\n")
cat("  MAE:", round(mae_log, 4), "\n\n")
cat("Regresión Polinomial:\n")
cat("  RMSE:", round(rmse_reg, 4), "\n")
cat("  MAE:", round(mae_reg, 4), "\n")
```



## Conclusiones y Recomendaciones

### Hallazgos Principales

1. **Desempeño de Prophet**:
   - Prophet captura exitosamente la tendencia de largo plazo en acciones tecnológicas
   - La detección automática de changepoints identifica quiebres estructurales (COVID-19, eventos corporativos)
   - Los intervalos de confianza son razonables para horizontes de corto plazo (60 días)
   - Mejor desempeño en acciones con tendencias fuertes (TSLA)

2. **Estacionalidad en Mercados Financieros**:
   - La estacionalidad semanal es menos pronunciada que en series de ventas
   - La estacionalidad anual captura efectos como el rally de fin de año
   - Los datos diarios de acciones tienen menos patrones estacionales que otras series temporales

3. **Enfoque de Regresión - Viabilidad**:
   - **SÍ es viable** para acciones con tendencias determinísticas fuertes
   - La regresión polinomial captura bien tendencias no lineales
   - La inclusión de variables exógenas (volumen) mejora marginalmente el ajuste
   - **Limitación**: No captura autocorrelación de corto plazo (ventaja de ARIMA)

4. **Complementariedad de Enfoques**:
   - **Prophet**: Excelente para tendencias, changepoints y pronósticos automatizados
   - **ARIMA**: Superior para autocorrelación y dependencias de corto plazo
   - **Regresión**: Útil para incorporar variables exógenas y tendencias determinísticas
   - Un **modelo híbrido** combinaría las fortalezas de los tres

### Comparación con Modelos Previos

| Característica | ARIMA | Prophet | Regresión |
|---------------|-------|---------|-----------|
| Tendencia no lineal | Limitada | Excelente | Buena (polinomios) |
| Autocorrelación | Excelente | Moderada | No captura |
| Changepoints | Manual | Automática | Manual (dummies) |
| Variables exógenas | ARIMAX | Regressors | Nativa |
| Interpretabilidad | Baja | Media | Alta |
| Intervalos de confianza | Sí | Sí | Sí |

### Limitaciones

1. **Mercados Financieros**:
   - Los precios de acciones tienen componente aleatorio fuerte (random walk hypothesis)
   - La eficiencia de mercado limita la predecibilidad de largo plazo
   - Los eventos extremos (black swans) no son predecibles

2. **Modelo Prophet**:
   - Asume que patrones históricos se repiten (puede fallar en cambios de régimen)
   - No captura correlaciones entre acciones (análisis univariado)
   - Pronósticos de largo plazo (>3 meses) tienen alta incertidumbre

3. **Regresión Temporal**:
   - Residuos muestran heterocedasticidad y autocorrelación
   - Viola supuestos de regresión clásica (errores i.i.d.)
   - Necesita correcciones (errores estándar robustos, GLS)

### Recomendaciones Prácticas

1. **Para Trading de Corto Plazo (<1 mes)**:
   - Usar modelos ARIMA-GARCH para capturar volatilidad clustering
   - Complementar con análisis técnico y sentiment analysis

2. **Para Inversión de Mediano Plazo (1-6 meses)**:
   - Prophet es una opción sólida para tendencias y patrones
   - Incorporar variables macroeconómicas en regresión

3. **Para Análisis Estratégico (>6 meses)**:
   - Combinar Prophet (tendencia) + modelos fundamentales (P/E, flujos de caja)
   - Usar escenarios y simulación Monte Carlo para incertidumbre

4. **Modelo Híbrido Sugerido**:
   ```
   Precio_t = Tendencia_Prophet + Componente_ARIMA + Variables_Exógenas + Error
   ```

### Trabajo Futuro

1. Implementar modelo ARIMAX con variables exógenas identificadas
2. Aplicar modelos de regresión con cambio de régimen (threshold models)
3. Incorporar análisis de volatilidad (GARCH) a los residuos
4. Evaluar modelos de machine learning (Random Forest, XGBoost) para comparación
5. Desarrollar sistema de trading algorítmico basado en pronósticos combinados

### Reflexión Final

Este capítulo demuestra que el **modelado de series de tiempo financieras requiere un enfoque multimodelo**. Prophet aporta automatización y robustez en la detección de patrones, mientras que la regresión proporciona interpretabilidad y flexibilidad para incorporar información externa. Sin embargo, ningún modelo por sí solo captura toda la complejidad de los mercados financieros.

La **serie de tiempo como regresión es viable** cuando:

- Existe una tendencia determinística fuerte
- Se dispone de variables exógenas relevantes  
- El objetivo es interpretabilidad y análisis exploratorio
- Se complementa con modelos que capturen autocorrelación

El análisis realizado complementa los modelos ARIMA y de estacionariedad previamente desarrollados, proporcionando una visión más completa del comportamiento temporal de los precios de acciones durante el período 2015-2025, que incluye eventos extremos como la pandemia COVID-19.
